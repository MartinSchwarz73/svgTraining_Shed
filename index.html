<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Muj prvni</title>
<link href="main.css" rel="stylesheet" type="text/css">
<!-- <script src="index.js"></script> -->
<br>
<script type="text/javascript" src="perspective_projection.js"></script>

</head>
<script language="javascript">
	const viewBoxSize = [500, 500];
	const Mproj = new Matrix44();
	const worldToCamera = new Matrix44();

	const Lumber = {
		w: 4,
		h: 2,
		l: 40,
		startPos: {x: 0.0, y: 0.0, z: 0.0},
		rot: {rotX: 45, rotY: 45, rotZ: 0.0},
		draw: function() {
			const vertices = [];  //array of Vert3D
			
			vertices.push(new Vert3D(this.startPos.x, this.startPos.y, this.startPos.z));  
			// alert(vertices[0]);
			vertices.push(new Vert3D(this.w, 0, 0));		//[1]
			vertices.push(new Vert3D(this.w, this.h, 0));		//[2]
			vertices.push(new Vert3D(0, this.h, 0));		//[3] end of 1st base
			vertices.push(new Vert3D(40+0, 40+0, this.l));		//[4] 2nd base
			vertices.push(new Vert3D(40+this.w, 40+0, this.l));		//[5]
			vertices.push(new Vert3D(40+this.w, 40+this.h, this.l));		//[6]
			vertices.push(new Vert3D(40+0, 40+this.h, this.l));		//[7]
			alert("Vstup:\n"+vertices);

			const vertCamera = new Vert3D(0,0,0); 
			const projectedVert = new Vert3D(0,0,0);
			
			for(var i=0; i<vertices.length; i++) {
/*				if (i==0) {									//[0] 1st vert is in 0,0,0 >> rotation has no effect
					vertices[i].x += this.startPos.x;
					vertices[i].y += this.startPos.y;
					vertices[i].z += this.startPos.z;
				}
				if (this.rot.rotX) { }
*/
				multPointMatrix(vertices[i], vertCamera, worldToCamera); 
				multPointMatrix(vertCamera, vertices[i], Mproj); 
			}
			alert("Po tranf\n"+vertices);

			return `<path d="M ${this.startPos.x} ${this.startPos.y} l ${this.w} 0 l 0 ${this.h} l -${this.w} 0 Z" />`;
		},
		toString: function () {
			this.draw();
		}
	};
	
	function drawScene() {
		// alert(Mproj);
		setProjectionMatrix(90, 0.1, 100, Mproj);
		alert(Mproj);
    	worldToCamera.setCell(42, -10);     // [3][1] = -10; 
    	worldToCamera.setCell(43, -20);     // [3][2] = -20; 
		alert(worldToCamera);
		let s = document.getElementById("front-view");
		if (s) {
			const studs = [];
			studs.push(Object.create(Lumber));
			studs.push(Object.create(Lumber));
				studs[studs.length-1].w = 10;
				studs[studs.length-1].h = 2;
				studs[studs.length-1].startPos = {x:10.0, y: 20.0, z: 0.0};
			var svgCode = "";
			studs.forEach(element => {svgCode += element.draw()});
			s.innerHTML = svgCode;
		}
	}
	
	function test() {
		const a = [];
		a.push(new String("Ahoj"));
		a.push(new Vert3D(1,2,3));
		alert(a);
	}
	
</script>
	
<body onload="drawScene();">
	<my-svg-vp>
  <svg id="front-view"
	   xmlns="http://www.w3.org/2000/svg"
	   stroke="black"
	   fill="none"
	   stroke-width="1px"
	   preserveAspectRatio="xMidYMin meet"
	   >
		<script>
			const viewbox = `0 0 ${viewBoxSize[0]} ${viewBoxSize[1]}`;
			document.querySelector('svg').setAttribute('viewBox', viewbox);
		</script>
<!--	  <circle cx="50" cy="50" r="40" />
	  <circle cx="150" cy="50" r="4" />
	  <svg viewBox="0 0 10 10" x="0" width="10">
		  <circle cx="5" cy="5" r="4" />
	  </svg>
--></svg>
</my-svg-vp>
</body>
</html>
